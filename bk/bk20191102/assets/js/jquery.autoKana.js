!function(x){x.fn.autoKana=function(n,t,e){var a,r,i,l,f,o,u=x.extend({katakana:!1},e),c=new RegExp("[^ 　ぁあ-んー]","g"),g=new RegExp("[ぁぃぅぇぉっゃゅょ]","g"),h=!1,v=null,s=!0;function p(){var n,t;if(""==(n=a.val()))d(),j();else{if(n=function(n){{if(-1!==n.indexOf(f))return n.replace(f,"");var t,e,a;for(e=f.split(""),a=n.split(""),t=0;t<e.length;t++)e[t]==a[t]&&(a[t]="");return a.join("")}}(n),i==n)return;i=n,s||(function(n){if(!s)if(1<Math.abs(l.length-n.length)){var t=n.join("").replace(g,"").split("");1<Math.abs(l.length-t.length)&&w()}else l.length==i.length&&l.join("")!=i&&i.match(c)&&w()}(t=n.replace(c,"").split("")),j(t))}}function j(n){if(!s&&(n&&(l=n),h)){var t=function(n){{if(u.katakana){var t,e,a;for(a=new String,e=0;e<n.length;e++)t=n.charCodeAt(e),a+=12353<=(r=t)&&r<=12435||12445==r||12446==r?String.fromCharCode(t+96):n.charAt(e);return a}return n}var r}(o+l.join(""));r.val(t)}}function d(){s=!1,i=f=o="",l=[]}function k(){o=r.val(),s=!1,f=a.val()}function w(){o+=l.join(""),s=!0,l=[]}a=x(n),r=x(t),h=!0,d(),a.blur(function(n){clearInterval(v)}),a.focus(function(n){k(),v=setInterval(p,30)}),a.keydown(function(n){s&&k()})}}(jQuery);